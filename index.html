<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EonFlow Dashboard</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-slate-100">
  <div id="root" class="min-h-screen"></div>
  <script type="text/babel">
    const { Calendar, MessageSquare, FileText, Settings, Play, Clock, CheckCircle, XCircle, Activity, Zap, RefreshCw } = lucide;

    const API = (window.__EONFLOW_API__ || window.REACT_APP_EONFLOW_API_URL || "%REACT_APP_EONFLOW_API_URL%");

    function Stat({icon:Icon, label, value}) {
      return (
        <div className="p-4 rounded-2xl bg-slate-900/60 border border-slate-800 flex items-center gap-3">
          <div className="p-2 rounded-xl bg-slate-800/60">
            <Icon size={20} />
          </div>
          <div>
            <div className="text-slate-400 text-sm">{label}</div>
            <div className="text-lg font-semibold">{value}</div>
          </div>
        </div>
      );
    }

    function Card({title, children, icon:Icon}) {
      return (
        <div className="rounded-2xl bg-slate-900/50 border border-slate-800 p-5">
          <div className="flex items-center gap-2 mb-3">
            {Icon && <Icon size={18} />}
            <h3 className="font-semibold">{title}</h3>
          </div>
          {children}
        </div>
      );
    }

    function App(){
      const [userId, setUserId] = React.useState("550e8400-e29b-41d4-a716-446655440000");
      const [loading, setLoading] = React.useState(false);
      const [history, setHistory] = React.useState([]);
      const [status, setStatus] = React.useState("");

      const fetchHistory = async () => {
        if(!API) return;
        const res = await fetch(`${API}/executions/${userId}`);
        if (res.ok) {
          const data = await res.json();
          setHistory(data);
        }
      };

      const callAgent = async (path) => {
        setLoading(true);
        setStatus("");
        try {
          const res = await fetch(`${API}${path}/${userId}`, { method: "POST" });
          const data = await res.json();
          if (!res.ok) throw new Error(data?.detail || "Failed");
          setStatus("Agent run successful");
          await fetchHistory();
        } catch (e) {
          setStatus(e.message || "Error");
        } finally {
          setLoading(false);
        }
      };

      React.useEffect(() => { fetchHistory(); }, []);

      return (
        <div className="max-w-5xl mx-auto p-6 space-y-6">
          <header className="flex items-center justify-between">
            <h1 className="text-2xl font-bold">EonFlow Dashboard</h1>
            <button onClick={fetchHistory} className="px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700 flex items-center gap-2">
              <RefreshCw size={16}/> Refresh
            </button>
          </header>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <Stat icon={Activity} label="Total Executions (last 25)" value={history.length} />
            <Stat icon={CheckCircle} label="Recent Status" value={status || "—"} />
            <Stat icon={Clock} label="User" value={userId.slice(0,8) + "…"} />
          </div>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            <Card title="Daily Digest" icon={Calendar}>
              <p className="text-sm text-slate-400 mb-3">Summarize today’s meetings, Slack mentions, and Notion updates.</p>
              <button disabled={loading} onClick={() => callAgent("/agents/daily-digest")} className="w-full py-2 rounded-xl bg-blue-600 hover:bg-blue-500 flex items-center justify-center gap-2">
                <Play size={16}/> {loading ? "Running..." : "Run Digest"}
              </button>
            </Card>
            <Card title="Follow-Up Agent" icon={MessageSquare}>
              <p className="text-sm text-slate-400 mb-3">Suggest post‑meeting follow‑ups.</p>
              <button disabled={loading} onClick={() => callAgent("/agents/follow-up")} className="w-full py-2 rounded-xl bg-emerald-600 hover:bg-emerald-500 flex items-center justify-center gap-2">
                <Play size={16}/> {loading ? "Running..." : "Run Follow‑Up"}
              </button>
            </Card>
            <Card title="Notion Summarizer" icon={FileText}>
              <p className="text-sm text-slate-400 mb-3">Summarize recent Notion page changes.</p>
              <button disabled={loading} onClick={() => callAgent("/agents/notion-summarizer")} className="w-full py-2 rounded-xl bg-violet-600 hover:bg-violet-500 flex items-center justify-center gap-2">
                <Play size={16}/> {loading ? "Running..." : "Run Summarizer"}
              </button>
            </Card>
          </div>

          <Card title="Execution History" icon={Settings}>
            <div className="space-y-3">
              {history.length === 0 && (
                <div className="text-slate-400 text-sm">No executions yet. Run an agent to see results here.</div>
              )}
              {history.map((e) => (
                <div key={e.id || Math.random()} className="p-4 rounded-xl bg-slate-900/60 border border-slate-800">
                  <div className="flex items-center justify-between mb-2">
                    <div className="font-medium">{e.agent_type}</div>
                    <div className={"text-xs px-2 py-1 rounded " + (e.status === "completed" ? "bg-emerald-600/20 text-emerald-300" : "bg-rose-600/20 text-rose-300")}>{e.status}</div>
                  </div>
                  <pre className="text-xs whitespace-pre-wrap text-slate-300">{JSON.stringify(e.output_data || {}, null, 2)}</pre>
                  <div className="text-xs text-slate-500 mt-2">{new Date(e.created_at || Date.now()).toLocaleString()}</div>
                </div>
              ))}
            </div>
          </Card>

          <footer className="text-xs text-slate-500">
            API: <code>{API || "not set"}</code>
          </footer>
        </div>
      );
    }

    ReactDOM.render(<App/>, document.getElementById('root'));
  </script>
</body>
</html>
